if(CMAKE_HOST_SYSTEM_NAME STREQUAL "Linux")
  set(CMAKE_CROSSCOMPILING OFF CACHE BOOL "")
endif()
set(CMAKE_SYSTEM_NAME Linux CACHE STRING "")

get_property(_CMAKE_IN_TRY_COMPILE GLOBAL PROPERTY IN_TRY_COMPILE)
if(NOT _CMAKE_IN_TRY_COMPILE)
  if(NOT VCPKG_CRT_LINKAGE)
    include(${CMAKE_CURRENT_LIST_DIR}/../../triplets/${VCPKG_TARGET_TRIPLET}.cmake)
  endif()

  if(VCPKG_CRT_LINKAGE STREQUAL "static")
    set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -pthread -static" CACHE STRING "")
    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -pthread -static" CACHE STRING "")
  elseif(NOT VCPKG_CRT_LINKAGE STREQUAL "dynamic")
    message(FATAL_ERROR "Invalid setting for VCPKG_CRT_LINKAGE: \"${VCPKG_CRT_LINKAGE}\". It must be \"static\" or \"dynamic\"")
  endif()

  set(CMAKE_CXX_STANDARD 20 CACHE STRING "")
  set(CMAKE_CXX_STANDARD_REQUIRED ON CACHE STRING "")
  set(CMAKE_CXX_EXTENSIONS OFF CACHE STRING "")

  set(CMAKE_AR "/opt/llvm/bin/llvm-ar" CACHE STRING "")
  set(CMAKE_RANLIB "/opt/llvm/bin/llvm-ranlib" CACHE STRING "")

  set(CMAKE_C_COMPILER "/opt/llvm/bin/clang" CACHE STRING "")
  set(CMAKE_CXX_COMPILER "/opt/llvm/bin/clang++" CACHE STRING "")

  set(LLVM_COMMON "-fasm -fPIC -fdiagnostics-absolute-paths -fcolor-diagnostics -D_DEFAULT_SOURCE=1")
  set(LLVM_COMMON_DEBUG "-g -O0 -DDEBUG")
  set(LLVM_COMMON_RELEASE "-Oz -ffast-math -flto=thin -DNDEBUG")

  set(CMAKE_C_FLAGS "${LLVM_COMMON} ${VCPKG_C_FLAGS}" CACHE STRING "")
  set(CMAKE_CXX_FLAGS "${LLVM_COMMON} -fcoroutines-ts ${VCPKG_CXX_FLAGS}" CACHE STRING "")

  set(CMAKE_C_FLAGS_DEBUG "${LLVM_COMMON_DEBUG} ${VCPKG_C_FLAGS_DEBUG}" CACHE STRING "")
  set(CMAKE_CXX_FLAGS_DEBUG "${LLVM_COMMON_DEBUG} ${VCPKG_CXX_FLAGS_DEBUG}" CACHE STRING "")

  set(CMAKE_C_FLAGS_RELEASE "${LLVM_COMMON_RELEASE} ${VCPKG_C_FLAGS_RELEASE}" CACHE STRING "")
  set(CMAKE_CXX_FLAGS_RELEASE "${LLVM_COMMON_RELEASE} ${VCPKG_CXX_FLAGS_RELEASE}" CACHE STRING "")

  set(CMAKE_STATIC_LINKER_FLAGS_DEBUG "" CACHE STRING "")
  set(CMAKE_SHARED_LINKER_FLAGS_DEBUG "-ltbb_debug" CACHE STRING "")
  set(CMAKE_EXE_LINKER_FLAGS_DEBUG "-ltbb_debug" CACHE STRING "")

  set(CMAKE_STATIC_LINKER_FLAGS_RELEASE "" CACHE STRING "")
  set(CMAKE_SHARED_LINKER_FLAGS_RELEASE "-O3 -Wl,-S -Wl,--thinlto-cache-dir=lto -ltbb" CACHE STRING "")
  set(CMAKE_EXE_LINKER_FLAGS_RELEASE "-O3 -Wl,-S -Wl,--thinlto-cache-dir=lto -ltbb" CACHE STRING "")

  set(CMAKE_STATIC_LINKER_FLAGS "" CACHE STRING "")
  set(CMAKE_SHARED_LINKER_FLAGS "${VCPKG_LINKER_FLAGS} -pthread" CACHE STRING "")
  set(CMAKE_EXE_LINKER_FLAGS "${VCPKG_LINKER_FLAGS} -pthread" CACHE STRING "")
endif()
